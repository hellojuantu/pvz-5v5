<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="screen-orientation" content="landscape" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌻</text></svg>"
    />
    <title>植物大战僵尸 - 联机对战</title>
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div
      id="loading-overlay"
      style="position: fixed; inset: 0; background: #111; z-index: 9999; display: flex; justify-content: center; align-items: center; font-size: 24px"
    >
      🌻 加载中...
    </div>

    <div class="reconnecting-overlay" id="reconnecting">🔄 重连中...</div>

    <!-- 横屏提示覆盖层 -->
    <div class="orientation-overlay" id="orientation-overlay">
      <div class="rotate-icon">📱</div>
      <div class="rotate-text">请旋转手机至横屏模式</div>
      <div class="rotate-hint">为获得最佳游戏体验，请将手机横过来</div>
    </div>

    <div id="welcome-screen" class="welcome-screen" style="display: none">
      <div class="welcome-content">
        <div class="welcome-title">🌻 植物大战僵尸 🧟</div>
        <div class="welcome-subtitle">5v5 联机对战</div>
        <input type="text" id="name-input" class="name-input-large" placeholder="取个名字" maxlength="10" />
        <br />
        <button id="enter-btn" class="enter-btn">进入大厅</button>
      </div>
    </div>

    <div id="lobby" class="lobby">
      <div class="lobby-header">
        <div class="lobby-title">
          <span class="logo-emoji">🎮</span>
          <span class="logo-text">对战大厅</span>
        </div>
        <div style="display: flex; align-items: center; gap: 15px">
          <div class="user-badge" style="cursor: pointer" onclick="editName()">
            ✏️
            <span id="display-name">玩家</span>
          </div>
          <a href="https://github.com/hellojuantu/pvz-5v5" target="_blank" class="github-link" title="GitHub">
            <svg viewBox="0 0 16 16" width="32" height="32" fill="currentColor">
              <path
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
              />
            </svg>
          </a>
        </div>
      </div>

      <!-- Refactored Flattened Grid Structure -->
      <div class="lobby-grid">
        <div class="lobby-left-column">
          <!-- Create Room Section -->
          <div class="section lobby-item-create" id="create-section">
            <div class="section-title">➕ 创建房间</div>
            <div class="create-container">
              <div class="mode-grid">
                <button class="mode-btn" data-mode="1">1v1</button>
                <button class="mode-btn selected" data-mode="2">2v2</button>
                <button class="mode-btn" data-mode="3">3v3</button>
                <button class="mode-btn" data-mode="4">4v4</button>
                <button class="mode-btn" data-mode="5">5v5</button>
              </div>
              <div style="margin: 10px 0; font-size: 14px; color: rgba(255, 255, 255, 0.7); text-align: left">
                最大波数:
                <select
                  id="max-waves"
                  style="background: rgba(0, 0, 0, 0.5); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 4px; border-radius: 4px"
                >
                  <option value="10">10波</option>
                  <option value="15" selected>15波</option>
                  <option value="20">20波</option>
                  <option value="30">30波</option>
                </select>
              </div>
              <button id="create-btn" class="create-btn">立即创建</button>
            </div>
          </div>

          <!-- Waiting Room Section (Initially Hidden) -->
          <div id="waiting-room" class="waiting-room section lobby-item-wait">
            <div class="waiting-title">⏳ 房间准备中...</div>
            <div class="waiting-slots">
              <div class="slot-column">
                <div class="slot-header plants">
                  <span>🌻 植物队</span>
                  <button class="add-bot-btn" id="add-plant-bot">🤖 添加AI</button>
                </div>
                <div id="plant-slots"></div>
              </div>
              <div class="slot-column">
                <div class="slot-header zombies">
                  <span>🧟 僵尸队</span>
                  <button class="add-bot-btn" id="add-zombie-bot">🤖 添加AI</button>
                </div>
                <div id="zombie-slots"></div>
              </div>
            </div>
            <button id="leave-btn" class="leave-btn">退出房间</button>
          </div>

          <!-- Leaderboard Section -->
          <div class="section leaderboard lobby-item-leaderboard">
            <div class="section-title">🏆 今日战绩</div>
            <div id="leaderboard-list" class="leaderboard-list">
              <div class="no-rooms">暂无记录</div>
            </div>
          </div>
        </div>

        <!-- Room List Section -->
        <div class="section room-section lobby-item-rooms">
          <div class="section-title">
            <span>📋 房间列表</span>
            <span id="refresh-btn" class="refresh-btn" title="刷新">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path
                  d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                />
              </svg>
            </span>
          </div>
          <div id="room-list" class="room-list">
            <div class="no-rooms">正在搜索房间...</div>
          </div>
        </div>
      </div>
    </div>

    <div id="team-modal" class="modal-overlay">
      <div class="modal-box">
        <div class="modal-title">选择阵营</div>
        <div class="team-grid">
          <div class="team-card plants" id="select-plants">
            <span class="icon">🌻</span>
            <span class="label">植物</span>
            <span class="count" id="modal-plants-count">0/2</span>
          </div>
          <div class="team-card zombies" id="select-zombies">
            <span class="icon">🧟</span>
            <span class="label">僵尸</span>
            <span class="count" id="modal-zombies-count">0/2</span>
          </div>
        </div>
        <button class="modal-close" id="modal-close">取消</button>
      </div>
    </div>

    <div id="main-wrapper">
      <div id="game-container">
        <div id="game-background"></div>
        <div id="top-bar">
          <div class="resource-box sun" id="sun-box">
            <span class="resource-icon">☀️</span>
            <span class="resource-count" id="sun-count">500</span>
          </div>
          <div class="resource-box brain" id="brain-box">
            <span class="resource-icon">🧠</span>
            <span class="resource-count" id="brain-count">500</span>
          </div>
          <div id="wave-display">
            波
            <span class="wave-num" id="wave-num">1</span>
            /
            <span id="max-waves-display">15</span>
          </div>
          <div id="player-info">
            <span class="team-icon" id="my-team-icon">🌻</span>
            <span class="name" id="my-name-display">玩家</span>
          </div>
          <div id="entity-menu"></div>
        </div>
        <div id="game-board"></div>
        <div class="row-selector" id="row-selector"></div>
        <div class="pause-overlay" id="pause-overlay">
          <div class="pause-title">⏸️ 游戏暂停</div>
          <div class="pause-text">等待玩家重连...</div>
        </div>
        <button class="exit-btn" id="exit-game-btn">🏳️ 投降</button>
      </div>
      <div id="side-panel">
        <div class="side-box">
          <div class="side-box-header" onclick="toggleBox('log')">
            <span>📜 日志</span>
            <span id="log-toggle">−</span>
          </div>
          <div class="side-box-content" id="action-log"></div>
        </div>
        <div class="side-box">
          <div class="side-box-header" onclick="toggleBox('chat')">
            <span>💬 聊天</span>
            <span id="chat-toggle">−</span>
          </div>
          <div class="side-box-content" id="chat-messages"></div>
          <div style="padding: 3px">
            <input type="text" id="chat-input" placeholder="Enter发送" maxlength="80" />
          </div>
        </div>
      </div>
    </div>

    <div id="game-end-modal" class="game-end-modal">
      <div class="game-end-content">
        <div class="game-end-title">游戏结束</div>
        <div class="game-end-winner" id="winner-text">植物获胜!</div>
        <button class="restart-btn" id="restart-game-btn">返回大厅</button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/game-core.js"></script>
    <script src="js/game-ui.js"></script>
    <script src="js/game-lobby.js"></script>
    <script src="js/game-mobile.js"></script>
    <script src="js/game-app.js"></script>
  </body>
</html>
